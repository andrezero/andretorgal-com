---
import Figure from '@components/mdx/Figure.astro';
import type { BaseNode } from '@queries/types';
import type { ImageMetadata } from 'astro';
import { dirname } from 'node:path';

export type Props = {
    node: BaseNode;
};

const { node } = Astro.props;

const image = node.images.internal.length
    ? dirname(node.mdxFilename) + '/' + node.images.internal[0]?.src.replace('./', '')
    : '';
const images = import.meta.glob<{ default: ImageMetadata }>('/src/pages/**/*.{jpeg,jpg,png,gif}');

const thumbImage = Object.entries(images).find(([key]) => {
    return image.endsWith(key);
});

console.log(thumbImage[1](), image);

// WIP;
---

{
    thumbImage && (
        <div class="thumb">
            <Figure src={thumbImage[1]()} />
        </div>
    )
}

<style is:global>
    .thumb,
    .thumb .figure,
    .thumb .block {
        width: 100%;
        height: 100%;
        min-height: 8em;
    }

    .thumb .figure picture {
        position: relative;
    }

    .thumb .figure picture img {
        position: absolute;
        top: 0;
        bottom: 0;
        object-fit: cover;
        object-position: 30%;
    }
</style>
